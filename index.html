<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="my notes">
<meta property="og:type" content="website">
<meta property="og:title" content="Linux-2017">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Linux-2017">
<meta property="og:description" content="my notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux-2017">
<meta name="twitter:description" content="my notes">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Linux-2017 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Linux-2017</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/20/http-ca.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/20/http-ca.html" itemprop="url">
                  https部署
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T16:08:51+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Https/" itemprop="url" rel="index">
                    <span itemprop="name">Https</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><h4 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a><strong>Curl</strong></h4><blockquote>
<p>基于URL语法在命令行方式下工作多文件传输工具</p>
</blockquote>
<p><strong>一些选项</strong></p>
<ul>
<li>-A/–user-agent <string>    设置用户代理</string></li>
<li>–basic   使用http基本验证</li>
<li>–tcp-nodelay  使用TCP_NODELAY</li>
<li>-e/–referer <url> 来源网址</url></li>
<li>–cacert <file> ssl</file></li>
<li>–compressed  要求返回的是压缩多形势</li>
<li>-H/–header <line></line> 自定义头信息</li>
<li>-I/–head  只显示响应报文首部信息</li>
<li>–limit-rate <rate>  设置传输速度</rate></li>
<li>-u/–user <user[:password]> 设置服务器多用户和密码</user[:password]></li>
<li>-m  设置最大传输时间</li>
<li>-k 　不使用证书</li>
</ul>
<p>eg: curl -I -m 5 -o /dev/null -s -w %{http_code} www.baidu.com</p>
<p><strong>mod_deflate模块</strong></p>
<ul>
<li><p>LoadModule deflate_module modules/mod_deflate.so</p>
</li>
<li><p>节省带宽，传输前对资源进行压缩</p>
</li>
<li><p>配置</p>
<blockquote>
<p>vim +$ /etc/httpd/conf/httpd.conf</p>
<p>SetOutputFilter DEFLATE<br>AddOutPutFilterByType DEFLATE text/html text/plain text/css text/xml text/javascript application/xhtml+xml</p>
</blockquote>
</li>
<li><p>可以用浏览器f12测试</p>
</li>
</ul>
<p><strong>Https</strong></p>
<ul>
<li><p>CA端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /etc/pki/CA</div><div class="line">(umask 077;openssl genrsa -out  private/cakey.pem 2048)</div><div class="line">openssl req -new -x509 -key private/cakey.pem -out cacert.pem</div><div class="line">touch serial index.txt</div><div class="line">echo 01 &gt; serial</div></pre></td></tr></table></figure>
</li>
<li><p>Http端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /etc/httpd</div><div class="line">mkdir ssl</div><div class="line">cd ssl</div><div class="line">(umask 077;openssl genrsa -out httpd.key 1024)</div><div class="line">openssl req -new -key httpd.key -out httpd.csr</div></pre></td></tr></table></figure>
<blockquote>
<p>将生成多csr发送至CA</p>
</blockquote>
</li>
<li><p>颁发</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">open ca -in httpd.csr -out /etc/pki/CA/certs/httpd.crt</div></pre></td></tr></table></figure>
<blockquote>
<p>将生成多证书发送给http服务器</p>
</blockquote>
</li>
<li><p>安装ssl模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum install mod_ssl</div><div class="line">httpd -M | grep ssl</div><div class="line">vim /etc/httpd/conf.d/ssl.conf</div><div class="line">SSLCertificateFile /etc/httpd/ssl/httpd.crt</div><div class="line">SSLCertificateKeyFile /etc/httpd/ssl/httpd.key</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/20/httpd-notes.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/20/httpd-notes.html" itemprop="url">
                  httpd常见指令及其配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-20T09:54:53+08:00">
                2017-04-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HTTPD"><a href="#HTTPD" class="headerlink" title="HTTPD"></a>HTTPD</h2><p><strong>Apache常用的配置指令</strong></p>
<ul>
<li><p>ServerTokens Http响应头，默认会包含apache详细版本号及php版本号</p>
<ul>
<li><p>语法：</p>
<blockquote>
<p>ServerTokens Major|Min|Pord|OS|Full</p>
</blockquote>
</li>
<li><p>默认值为 ServerToken OS</p>
</li>
<li><p>模块 core,这个指令控制服务器回应给客户端的＂Server:”应答头是否包含关于服务器操作系统和编译进的模块描述信息．</p>
</li>
</ul>
</li>
<li><p>ServerRoot “/etc/httpd”　指明配置文件存放多位置</p>
</li>
<li><p>DocumentRoot  网页根目录</p>
</li>
<li><p>ServerName www.test.com:80</p>
<blockquote>
<p>定义网站域名</p>
<p>需要借助DNS将域名解析到服务器IP</p>
</blockquote>
</li>
<li><p>AddDefaultCharset UTF-8|GBK|GB2312|GB18030 设定默认字符集</p>
<p>​</p>
</li>
</ul>
<p><strong>Http请求处理多连接访问</strong></p>
<ul>
<li><p>非保持连接(短连接)</p>
<blockquote>
<p>对于大量并发场景中，短连接多三次握手以及四次挥手会占据大量带宽</p>
</blockquote>
</li>
<li><p>保持连接(长连接) Keep-alive</p>
<blockquote>
<p>避免过多多连接保持，可以从时间和数量两个维度对长连接加以限制,Http2.4支持毫秒级别多限制</p>
</blockquote>
<p><strong>三个参数</strong></p>
<ul>
<li>KeepAlive On|Off</li>
<li>KeepAlive Timeout  15</li>
<li>MaxKeepAliveRequests 100</li>
</ul>
<p><strong>用Telnet测试</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@test ~]# telnet 127.0.0.1 80</div><div class="line">Trying 127.0.0.1...</div><div class="line">Connected to 127.0.0.1.</div><div class="line">Escape character is &apos;^]&apos;.</div><div class="line">GET / HTTP/1.1</div><div class="line">Host:172.18.50.61</div><div class="line"></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Thu, 20 Apr 2017 02:45:55 GMT</div><div class="line">Server: Apache</div><div class="line">Last-Modified: Thu, 20 Apr 2017 02:16:22 GMT</div><div class="line">ETag: &quot;24bf8-5-54d8fba2fe78d&quot;</div><div class="line">Accept-Ranges: bytes</div><div class="line">Content-Length: 5</div><div class="line">Content-Type: text/html; charset=UTF-8</div><div class="line"></div><div class="line">test</div><div class="line">Connection closed by foreign host.</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>MPM详细配置</strong></p>
<ul>
<li>查看Httpd程序多模块列表<ul>
<li>httpd -l　查看静态编译多模块</li>
<li>httpd -M 查看静态编译及动态编译多模块</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@test ~]# httpd -M | grep prefork</div><div class="line">httpd: Could not reliably determine the server&apos;s fully qualified domain name, using test.com for ServerName</div><div class="line"> mpm_prefork_module (static)</div><div class="line">Syntax OK</div></pre></td></tr></table></figure>
<blockquote>
<p>在apache2.2中,MPM模块不支持动态装卸载</p>
</blockquote>
<ul>
<li><p>prefork</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule prefork.c&gt;</div><div class="line">StartServers       8		服务进程启动时启动多少个空闲进程</div><div class="line">MinSpareServers    5		最少空闲进程数，如果少于５，主控进程会再启动几个，使空闲进程到达5</div><div class="line">MaxSpareServers   20		最大空闲进程数，如果到达20,则会被回收</div><div class="line">ServerLimit      256		所允许启动的最大在线进程数</div><div class="line">MaxClients       256		最大允许启动进程数量响应用户请求</div><div class="line">MaxRequestsPerChild  4000　　每个进程最多可以处理多少个请求，超过则销毁</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>woker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule worker.c&gt;</div><div class="line">StartServers         4		服务器启动是启动多少个空闲进程</div><div class="line">MaxClients         300		最大并发响应数量</div><div class="line">MinSpareThreads     25		最小空闲线程</div><div class="line">MaxSpareThreads     75		最大空闲线程</div><div class="line">ThreadsPerChild     25		每个进程启动25个线程</div><div class="line">MaxRequestsPerChild  0		每个进程可以处理无限个请求</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>event</p>
</li>
</ul>
<blockquote>
<p>Centos 6上同时提供了三个二进制文件(/usr/sbin/httpd  /usr/sbin/httpd.event  /usr/sbin/httpd.worker)，分别对应不同多MPM支持，默认使用prefork,可以使用http -l查看</p>
<p>可以通过修改/etc/sysconfig/httpd的HTTPD=/usr/sbin/httpd.worker切换MPM</p>
</blockquote>
<p><strong>DOS动态装卸载</strong></p>
<ul>
<li><p>LoadModule <mod_name><mod_path></mod_path></mod_name></p>
<blockquote>
<p>模块文件路径使用相对路径</p>
</blockquote>
</li>
</ul>
<p><strong>Http站点访问控制</strong></p>
<ul>
<li><p>文件系统/URL路径</p>
<blockquote>
<directory "="" var="" www="" html"=""><br><br>…<br><br></directory>

<p>​</p>
<file "=""><br><br>…<br><br></file>

<p>​</p>
<filematch "pattern"=""><br><br>…<br><br></filematch>

<p>使用正则表达式模式匹配</p>
<location ""=""><br><br>…<br><br></location>
</blockquote>
</li>
<li><p>Options Indexes FollowSymlinks</p>
<blockquote>
<p>Options定义此目录内资源访问的特性，控制被定义多目录下所指定多各种资源多被访问模式，后跟一个或多个空白字符分割多选项列表</p>
<p>indexs指明多URL路径不存在与定义多主页面资源相符的资源文件时候，返回索引列表给用户，目录浏览功能，一般关掉</p>
<p>FollowSymlinks 允许跟踪符号连接文件所指向的源文件</p>
<p>跟踪符号链接，如果目录下存在软连接，则可以访问软连接指向多文件</p>
<p>Includes     //允许启用服务端包含</p>
<p>SymLinlifOwnerMatch        //源文件和链接多目标文件多属主属组相同多时候才允许跟踪访问</p>
<p>ExecCGI        //允许执行CGI脚本</p>
<p>MultiViews        //允许执行内容协商</p>
<p>None        //全部都不</p>
<p>ALL            //所有都</p>
<p>AllowOverride    //与访问控制相关的那些执行可以放在.htacesss文件中，每个目录下都可以有一个，但是使用.htacess会使网站对目录多资源解析变多非常慢，不推荐使用。</p>
</blockquote>
</li>
<li><p>基于源地址定义访问规则</p>
<blockquote>
<p>Order    allow,deny</p>
<p>ALlow    for    all</p>
<p>Order定义生效法则，写在后面表示默认法则</p>
<p>Allow from all，Deny from 来源ip或者网络地址</p>
<p>示例:</p>
<p>​    Order allow,deny</p>
<p>​    Deny from 172.18.100.1</p>
<p>​    allow form 172.18</p>
<p>仅仅允许172.18除了100.1的地址访问</p>
<p>​</p>
<p>目录别名</p>
<p>vim /etc/httpd/conf/httpd.conf</p>
<p>/Alias后加</p>
<p>Alias /aa/ “var/www/html/bb/“</p>
<p>后面必须为绝对路径</p>
</blockquote>
</li>
</ul>
<p><strong>Http日志相关设定</strong></p>
<ul>
<li><p>错误日志</p>
<blockquote>
<p>定义: ErrorLog logs/error_log</p>
</blockquote>
</li>
<li><p>错误日志级别</p>
<ul>
<li>debug    所有信息，只要产生就全部记录</li>
<li>info         所有多信息数据</li>
<li>notice     引起注意</li>
<li>warn       警告</li>
<li>error       发生错误</li>
<li>crit           级别很严重</li>
<li>alert         红色警戒</li>
<li>emerg      引起恐慌</li>
</ul>
</li>
<li><p>访问日志</p>
<blockquote>
<p>定义 CustomLog logs/access_log combined</p>
<p>格式 日志路径 日志格式{combined|common|referer|agent}</p>
<p>日志格式定义</p>
<blockquote>
<p>LogFormat “%h %l %u %t \”%r\” %&gt;s %b \”%{Referer}i\” \”%{User-Agent}i\”” combined<br>LogFormat “%h %l %u %t \”%r\” %&gt;s %b” common<br>LogFormat “%{Referer}i -&gt; %U” referer<br>LogFormat “%{User-agent}i” agent</p>
</blockquote>
<p>“%h %l %u”可以称为宏或者是通配符</p>
<p>日志格式示例</p>
<p>172.18.100.7 - - [20/Apr/2017:14:58:02 +0800] “GET /a/ HTTP/1.1” 404 262 “-“ “Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0”</p>
<p>客户端地址 登录名 认证名 时间 请求首部 状态吗 响应报文大小 从那个页面跳过来 浏览器类型</p>
</blockquote>
</li>
</ul>
<p><strong>基于用户的访问控制</strong></p>
<ul>
<li><p>常见多用户认证方式</p>
<blockquote>
<p>http协议自身提供多认证(明文)–&gt;basic 明文认证</p>
<p>表单认证–&gt;digest消息摘要认证</p>
</blockquote>
</li>
<li><p>认证质询</p>
<blockquote>
<p>www-authenticate</p>
<p>​    响应码为401,拒绝客户端请求，并说明要求提供客户端帐号密码</p>
<p>authorization    </p>
<p>​    客户端用户填入帐号密码后再次发送请求报文，认证通过时，则服务器发送响应多资源</p>
<p>安全域，需要用户认证后才能访问多路径。应该通过名称对其进行标识，以便告知用户认证多原因</p>
<p>用户帐号密码存放多位置</p>
<p>​    虚拟帐号:仅用于访问某服务时用到多认证标识</p>
<p>​    存储: 文本文件、sql数据库、LDAP轻量级目录访问协议</p>
</blockquote>
</li>
<li><p>Basic认证配置步骤</p>
<blockquote>
<directiry ""="">

<p>AuthType Basic<br>AuthName “String”<br>AuthUserFile “/PATH/TO/HTTPD_USER_PASSWD_FILE”</p>
<p># AuthGroupFile “/PATH/TO/HTTPD_GROUP_FILE” #基于组来认证<br>Require user username1 username2…</p>
<p># Require group grpname1 grpname2 …</p>
<p></p>
<p>示例:</p>
<blockquote>
<directory "="" data="" www=""><br>Options None<br>AllowOverride None<br>AuthType Basic<br>AuthName “Admin Realm,show something”<br>AuthUserFile “/etc/httpd/conf/.htpasswd”<br>Require user tom<br><br># Require user vaild-user //允许所有用户登录<br><br></directory>

</blockquote>
<p>新建密码文件</p>
<p>htpasswd -c -m /etc/httpd/conf/.htpasswd</p>
<p>​    -c 第一次创建密码文件时使用</p>
<p>​    -m md5</p>
<p>​    -s force sha encrypt the password</p>
<p>​    -D delete the spacifien user</p>
</directiry></blockquote>
</li>
</ul>
<p><strong>Http虚拟主机</strong></p>
<ul>
<li><p>实现方式</p>
<ul>
<li>基于ip</li>
<li>基于port</li>
<li>基于FQDN</li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li><p>注释DocumentRoot指令，禁用Main主机</p>
</li>
<li><p>配置语法</p>
<blockquote>
<virtualhost ip:port=""><br><br>​    ServerName FQDN<br><br>​    DocumentRoot “ “ //站点路径<br><br></virtualhost>

<p>可用的指令</p>
<p>​    ServerAlias           虚拟主机的别名</p>
<p>​    Errorlog            </p>
<p>​    CustomLog        日志</p>
<p>​    <directory ""=""> ..</directory></p>
</blockquote>
</li>
<li><p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;VirtualHost 172.18.50.61:80&gt;</div><div class="line">    DocumentRoot /data/www/a</div><div class="line">&lt;/VirtualHost&gt;</div><div class="line"></div><div class="line">&lt;VirtualHost 172.18.50.61:800&gt;</div><div class="line">    DocumentRoot /data/www/b</div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>Http状态页面</strong></p>
<ul>
<li><p>开启status模块</p>
<blockquote>
<p>LoadModule status_module modules/mod_status.so</p>
</blockquote>
</li>
<li><p>启动状态访问页面</p>
<blockquote>
<location server-status=""><br><br>    SetHandler server-status<br>    Order deny,allow<br>    Allow from all<br>    Allow from .example.com<br></location>
</blockquote>
</li>
<li><p>工作进程状态</p>
<ul>
<li>- 等待连接请求</li>
<li>Ｗ正处于工作状态　发送响应报文进程</li>
<li>S  正在创建</li>
<li>R 正在读取请求</li>
<li>K 正在保持连接</li>
<li>D 正在执行DNS查询</li>
<li>C 正在关闭连接</li>
<li>L 正在记录日志</li>
<li>G 正在优雅多关闭</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/18/dropbear.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/18/dropbear.html" itemprop="url">
                  dropbear编译安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T20:14:08+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="编译安装dropbear"><a href="#编译安装dropbear" class="headerlink" title="编译安装dropbear"></a>编译安装dropbear</h1><p><strong>安装准备</strong></p>
<ol>
<li>安装Development tools</li>
<li>tar xvf dropbear.tar.bzip2</li>
</ol>
<p><strong>编译安装</strong></p>
<ol>
<li>./configure –prefix=/usr/local/dropbear –sysconfdir=/etc/dropbear</li>
<li>make &amp;&amp; make install</li>
</ol>
<p><strong>生成公钥并启动服务</strong></p>
<ol>
<li>/usr/local/dropbear/bin/dropbearkey -t rsa|dss|ecdsa -f /etc/dropbear/dropbear_rsa_host_key -s 2048</li>
<li>dropbear -p 2222 -F -E 前台运行</li>
<li>dropbear -p 2222 后台</li>
</ol>
<p><strong>测试</strong></p>
<blockquote>
<p>ssh -p 2222 root@ip_address</p>
<p>dbclient -p 2222 root@ip_address</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/18/bind编译安装.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/18/bind编译安装.html" itemprop="url">
                  编译安装bind
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T14:14:08+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="bind编译安装"><a href="#bind编译安装" class="headerlink" title="bind编译安装"></a>bind编译安装</h2><p>解压源码包</p>
<blockquote>
<p>tar xvf bin9.tar.gz</p>
</blockquote>
<p>添加named用户</p>
<blockquote>
<p>useradd -r -s /sbin/nologin -d /var/named -u 53 named</p>
</blockquote>
<p>创建用户家目录并修改所属组及其权限</p>
<blockquote>
<p>mkdir /var/named</p>
<p>chown root.named /var/named</p>
<p>chmod 770 /var/named</p>
</blockquote>
<p>安装依赖</p>
<blockquote>
<p>yum install gcc  openssl-devel -y</p>
</blockquote>
<p>编译安装</p>
<blockquote>
<p>./configure –prefix=/usr/local/dns  –sysconfdir=/etc/named</p>
<p>make &amp;&amp; make install</p>
</blockquote>
<p>将生成打文件加入path变量</p>
<blockquote>
<p>vim /etc/profie.d/bind9.sh</p>
<p>PATH=$PATH:/usr/local/dns/bin:/usr/local/dns/sbin</p>
<p>source /etc/profile.d/bind8.sh</p>
</blockquote>
<p>添加man帮助</p>
<blockquote>
<p>vim /etc/man_db.conf</p>
<p>MANDATORY_MANPATH                       /usr/local/dns/share/man</p>
<p>mandb</p>
</blockquote>
<p>添加配置文件</p>
<blockquote>
<p>vim /etc/named/named.conf</p>
<p>options {</p>
<p>​    directory “/var/named”;</p>
<p>};</p>
<p>zone “test.com” {</p>
<p>​    type master;</p>
<p>​    file “test.com.zone”;</p>
<p>};</p>
</blockquote>
<p>添加zone文件</p>
<blockquote>
<p>[root@shen named]# cat test.com.zone<br>$TTL 86400<br>@ IN SOA dns1 root.test.com. ( 1 1D 1h 1w 1h )</p>
<p>​    NS    dns1</p>
<p>dns1    A    172.18.50.71<br>www    CNAME    web<br>web    A    172.18.50.71</p>
</blockquote>
<p>确保named用户对其可读</p>
<p>named-checkconf 检查配置文件语法是否正确</p>
<p>named-checkzone “test.com” /var/named/test.com.zone 检查zone文件</p>
<p>启动服务</p>
<blockquote>
<p>named</p>
</blockquote>
<p>测试</p>
<blockquote>
<p>[root@shen named]# dig www.test.com @127.0.0.1</p>
<p>; &lt;&lt;&gt;&gt; DiG 9.11.0-P5 &lt;&lt;&gt;&gt; www.test.com @127.0.0.1<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6599<br>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 2</p>
<p>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>; COOKIE: 6765dbacd3bfd785ae70758258f5822040069e69289113fa (good)<br>;; QUESTION SECTION:<br>;www.test.com.            IN    A</p>
<p>;; ANSWER SECTION:<br>www.test.com.        86400    IN    CNAME    web.test.com.<br>web.test.com.        86400    IN    A    172.18.50.71</p>
<p>;; AUTHORITY SECTION:<br>test.com.        86400    IN    NS    dns1.test.com.</p>
<p>;; ADDITIONAL SECTION:<br>dns1.test.com.        86400    IN    A    172.18.50.71</p>
<p>;; Query time: 0 msec<br>;; SERVER: 127.0.0.1#53(127.0.0.1)<br>;; WHEN: Mon Apr 17 23:04:00 EDT 2017<br>;; MSG SIZE  rcvd: 138</p>
</blockquote>
<p>切换到前台执行</p>
<blockquote>
<p>yum provides killall</p>
<p>yum install psmisc-22.20-11.el7.x86_64      </p>
<p>killall named</p>
<p> named -f -d 3 -g</p>
</blockquote>
<p>添加根节点</p>
<blockquote>
<p>dig -t NS . &gt; /var/named/namd.ca</p>
<p>vim /etc/named/named.conf</p>
<p>zone “.” {</p>
<p>​    type hint;</p>
<p>​    file “named.ca”;</p>
<p>};</p>
</blockquote>
<p>rndc错误</p>
<blockquote>
<p>[root@shen named]# rndc status<br>rndc: neither /etc/named/rndc.conf nor /etc/named/rndc.key was found</p>
</blockquote>
<p>修复</p>
<blockquote>
<p>rndc-confgen -r /dev/urandom  &gt; /etc/named/rndc.conf</p>
<p>tail -n 12 rndc.conf | sed ‘s/# //‘ &gt;&gt; /etc/named/named.conf </p>
<p>vim /etc/named/named.conf</p>
<p>删除 Use with 以及End of name 这两行</p>
<p>重启服务后</p>
<p>[root@shen named]# rndc status<br>version: BIND 9.11.0-P5 <id:ad4fb79><br>running on shen.org: Linux x86_64 3.10.0-514.el7.x86_64 #1 SMP Tue Nov 22 16:42:41 UTC 2016<br>boot time: Tue, 18 Apr 2017 03:41:03 GMT<br>last configured: Tue, 18 Apr 2017 03:41:03 GMT<br>configuration file: /etc/named/named.conf<br>CPUs found: 1<br>worker threads: 1<br>UDP listeners per interface: 1<br>number of zones: 100 (98 automatic)<br>debug level: 3<br>xfers running: 0<br>xfers deferred: 0<br>soa queries in progress: 0<br>query logging is OFF<br>recursive clients: 0/900/1000<br>tcp clients: 0/150<br>server is up and running</id:ad4fb79></p>
</blockquote>
<p>压力测试</p>
<blockquote>
<p>cd /root/bind-9.11.0-P5/contrib/queryperf</p>
<p>./cconfigure</p>
<p>make</p>
<p>/root/bind-9.11.0-P5/contrib/queryperf</p>
<p>vim  ~/test.txt</p>
<p>www.test.com A</p>
<p>test.com NS</p>
<p>:1,$y</p>
<p>多复制一点</p>
<p>/root/bind-9.11.0-P5/contrib/queryperf</p>
</blockquote>
<p>打开日志功能</p>
<blockquote>
<p>rndc querylog</p>
<p>rndc status</p>
</blockquote>
<p>dns排错</p>
<blockquote>
<p>NXDOMAIN: the queried name does not exits in the zone.</p>
<p>可能是CNAME对应打A记录不存在导致</p>
<p>REFUSED: The nameserver refused the client’s DNS</p>
<p>可能是DNS策略导致</p>
<p>避免CNAME指向CNAME记录,可能产生回环<br>test.example.com. IN CNAME lab.example.com.<br>lab.example.com. IN CNAME test.example.com.</p>
<p>正确配置PTR记录,许多服务依赖PTR,如sshd,MTA</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/11/ca.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/11/ca.html" itemprop="url">
                  ca
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-11T20:40:55+08:00">
                2017-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="创建ca"><a href="#创建ca" class="headerlink" title="创建ca"></a>创建ca</h1><h4 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h4><ul>
<li>生成私钥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(umask 066;openssl genrsa -out /etc/pki/CA/private/cakey.pem 4096)</div></pre></td></tr></table></figure>
<ul>
<li>自颁发证书</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /etc/pki/CA</div><div class="line">openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days 99999</div></pre></td></tr></table></figure>
<ul>
<li>创建后面需要用到的文件<ul>
<li>touch /etc/pki/CA/index.txt</li>
<li>echo 01 &gt; /etc/pki/CA/serial</li>
</ul>
</li>
</ul>
<h4 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h4><ul>
<li>生成私钥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(umask 077;openssl genrsa -out /etc/pki/tls/private/test.key 1024)</div></pre></td></tr></table></figure>
<ul>
<li>生成申请文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /etc/pki/tls/private</div><div class="line">openssl req -new -key test.key -out /etc/pki/tls/test.csr -days 365</div></pre></td></tr></table></figure>
<h4 id="颁发证书"><a href="#颁发证书" class="headerlink" title="颁发证书"></a>颁发证书</h4><ul>
<li>将client端申请文件scp至ca端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp /etc/pki/tls/test.csr root@ca_ip:~</div></pre></td></tr></table></figure>
<ul>
<li>颁发</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">opensl ca -in test.csr -out /etc/pki/CA/certs/test.crt -days 365</div></pre></td></tr></table></figure>
<ul>
<li>然后将test.crt –&gt;client</li>
</ul>
<p><strong>注意</strong> ： 默认国家、省、公司名称三项必须和CA一致</p>
<h4 id="吊销证书"><a href="#吊销证书" class="headerlink" title="吊销证书"></a>吊销证书</h4><ul>
<li><p>echo 01 &gt; /etc/pki/CA/crlumber  首次生成吊销列表需要创建此文件</p>
<ul>
<li>openssl ca -revoke newcerts/01.pem</li>
<li>openssl ca -gencrl -out crl /cr2.pem</li>
</ul>
</li>
<li><p>查看是否吊销</p>
<ul>
<li><p>openssl crl -in crl/cr1.pem -noout -text</p>
</li>
<li><p>复制crl/cr1.pem到windows,改后缀为crl查看是否成功</p>
<p>​</p>
</li>
</ul>
</li>
</ul>
<h4 id="一些用到的命令"><a href="#一些用到的命令" class="headerlink" title="一些用到的命令"></a>一些用到的命令</h4><ul>
<li><p>openssl  req -new -x509 -key  cakey.pem -days 9999 -out cacert.pem</p>
<ul>
<li>-new 生成新证书签署请求</li>
<li>-x509 专用于CA生成自签证书</li>
<li>-key 生成请求时用到的私钥文件</li>
<li>-days n 证书的有效期限，单位为天</li>
<li>-out /path/filename 证书的保存路径</li>
</ul>
</li>
<li><p>查看证书的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl x509 -in /path/证书 -noout -text|issuer|subject|serial|dates</div></pre></td></tr></table></figure>
</li>
<li><p>查看指定编号的证书状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl ca -status SERIAL</div></pre></td></tr></table></figure>
</li>
</ul>
<p>一个搭建ca环境的脚本</p>
<p>ca_server.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">read -p &quot;Please enter the certificate is valid(The unit is day):&quot; c_time</div><div class="line">read -p &quot;Country Name (2 letter code) [XX]:&quot; c_name</div><div class="line">read -p &quot;State or Province Name (full name) []:&quot; p_name</div><div class="line">read -p &quot;Organization Name (eg, company) [eg test.com]:&quot; o_name</div><div class="line"></div><div class="line">ca_key=&quot;/etc/pki/CA/private/cakey.pem&quot;</div><div class="line">ca_pub=&quot;/etc/pki/CA/cacert.pem&quot;</div><div class="line"></div><div class="line">if [ -f  $ca_key ];then</div><div class="line">	echo $ca_key is esxit.</div><div class="line">	exit 1</div><div class="line">else</div><div class="line">	(umask 066;openssl genrsa -out $ca_key  4096) &amp;&gt;/dev/null</div><div class="line"></div><div class="line">	echo -e &quot;$c_name\n$p_name\n\n$o_name\n\nca.$o_name\n\n&quot;|openssl req -new -x509 -key $ca_key -out $ca_pub -days $c_time &amp;&gt; /dev/null</div><div class="line">fi</div><div class="line"></div><div class="line">touch /etc/pki/CA/index.txt</div><div class="line">echo 01 &gt; /etc/pki/CA/serial</div><div class="line"></div><div class="line">echo $ca_key $ca_pub is ok,day is $c_time</div></pre></td></tr></table></figure>
<p>ca_client.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">read -p &quot;Please enter the certificate is valid(The unit is day):&quot; c_time</div><div class="line"></div><div class="line">key_client=&quot;/etc/pki/tls/private/test.key&quot;</div><div class="line"></div><div class="line">(umask 077;openssl genrsa -out $key_client 1024) &amp;&gt; /dev/null</div><div class="line"></div><div class="line">openssl req -new -key $key_client  -out  /etc/pki/tls/test.csr -days $c_time &amp;&gt; /dev/null</div></pre></td></tr></table></figure>
<p>手工</p>
<blockquote>
<p>scp root@ip_client:/etc/pki/tls/test.csr 至ca_server</p>
<p>openssl ca -in test.csr  -out /etc/pki/CA/certs/test.crt -days 365</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/08/systemd.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/08/systemd.html" itemprop="url">
                  systemd
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-08T22:22:22+08:00">
                2017-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h1><ul>
<li>POST–&gt;Boot Sequence–&gt;Bootloader–&gt;Kernel initramfs(initrd)–&gt;rootfs–&gt;/sbin/init<ul>
<li>init <ul>
<li>Centos 5 : Sysv init </li>
<li>Centos 6 : Upstart</li>
<li>Centos 7 : Systemd</li>
</ul>
</li>
</ul>
</li>
<li>Systemd: 系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其他进程．系统引导时实现服务并行启动，按需启动守护进程，自动化的服务依赖关系管理，同时采用socket式与Ｄ-Bus总线式激活服务，系统状态快照．</li>
</ul>
<h2 id="unit"><a href="#unit" class="headerlink" title="unit"></a>unit</h2><p><strong>unit</strong>表示不同类型的systemd对象，通过配置文件进行标识和配置；文件中主要包含了系统服务，监听socket,保存系统快照以及其他与init相关的信息</p>
<p><strong>配置文件</strong>：</p>
<ul>
<li>/usr/lib/systemd/system: 每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/</li>
<li>/run/systemd/system: 系统执行过程中所产生的服务脚本，比上面目录优先运行</li>
<li>/etc/systemd/system: 管理员建立的执行脚本，类似与/etc/rc.d/rcN.d/sxx类的功能，比上面目录优先运行</li>
</ul>
<p><strong>unit类型</strong></p>
<ul>
<li>Systemctl -t help 查看unit类型</li>
<li>Service unit: 文件扩展名为.service，用于定义系统服务</li>
<li>Target uniq: .device,用于定义内核识别的设备</li>
<li>Ｍount unit: .mount,用于定义文件系统挂载点</li>
<li>Socket unit: .socket,用于标识进程间通信用的socket文件，也可在系统启动时，延迟启动服务，实现按需启动</li>
<li>Snapshot unit: .snapshot,管理系统快照</li>
<li>Swap unit: .swao,用于标识swap设备</li>
<li>Automount unit: .automount,文件系统的自动挂载点</li>
<li>Path unit: .path,用于定义文件系统中的一个文件或目录使用，常用于当文件系统变化时，延迟激活服务，如：spool目录</li>
</ul>
<p><strong>管理服务</strong></p>
<ul>
<li>systemctl start|stop|reload|restart|status name.service</li>
<li>条件式重启: 已启动才重启，否则不做操作: systemctl try-restart name.service</li>
<li>禁止自动和手动启动: Systemctl mask name.service</li>
<li>取消禁止: Systemctl unmask name.service</li>
</ul>
<p><strong>服务查看</strong></p>
<ul>
<li><p>查看某服务当前激活与否的状态</p>
<blockquote>
<p>systemctl is-active name.service</p>
</blockquote>
</li>
<li><p>查看所有已经激活的服务</p>
<blockquote>
<p>systemctl list-unis –type|-t service</p>
</blockquote>
</li>
<li><p>查看所有服务</p>
<blockquote>
<p>systemctl list-units –type service -all|-a</p>
</blockquote>
</li>
<li><p>设定某服务的开机启动</p>
<blockquote>
<p>chkconfig name on ==&gt; systemctl enable name.service</p>
</blockquote>
</li>
<li><p>设定某服务的开机禁止启动</p>
<blockquote>
<p>chkconfig name off ==&gt; systemctl disable name.service</p>
</blockquote>
</li>
<li><p>查看所有的开机自启状态</p>
<blockquote>
<p>chkconfig –list ==&gt; systemctl list-unit-files –type service</p>
</blockquote>
</li>
<li><p>用来列出该服务在哪些运行级别下启用和禁用</p>
<blockquote>
<p>chkconfig sshd -list ==&gt; ls /etc/systemd/system/*.wants/sshd.service</p>
</blockquote>
</li>
<li><p>查看服务是否开机自启</p>
<blockquote>
<p>systemctl is-enabled name.service</p>
</blockquote>
</li>
<li><p>其他命令</p>
<blockquote>
<p>查看服务的依赖关系:</p>
<p>systemctl list-dependencies name.service</p>
</blockquote>
</li>
<li><p>杀掉进程</p>
<blockquote>
<p>systemctl kill 进程名</p>
</blockquote>
</li>
</ul>
<p><strong>服务状态</strong></p>
<ul>
<li>systemctl list-unit-files –type service –all显示状态</li>
<li>loaded: Unit配置文件已处理</li>
<li>active(running) : 一次或多次持续处理的运行</li>
<li>active(exited): 成功完成一次性的配置</li>
<li>active(waiting): 运行中，等待一个事件</li>
<li>inactive: 不运行</li>
<li>enabled: 开机启动</li>
<li>disabled: 开机不启动</li>
<li>static: 开机不启动，但可被另一个启用的服务激活</li>
</ul>
<p><strong>命令示例</strong></p>
<ul>
<li><p>显示所有单元状态</p>
<blockquote>
<p>systemctl 或 systemctl list-units</p>
</blockquote>
</li>
<li><p>只显示服务单元的状态</p>
<blockquote>
<p>systemctl –type=service</p>
</blockquote>
</li>
<li><p>显示sshd服务单元</p>
<blockquote>
<p>systemctl status sshd.service -l</p>
</blockquote>
</li>
<li><p>验证sshd服务当前是否活动</p>
<blockquote>
<p>systemctl is-active sshd</p>
</blockquote>
</li>
<li><p>列出所有服务状态的所有服务单元</p>
<blockquote>
<p>systemctl list-units –type=service </p>
</blockquote>
</li>
<li><p>列出所有服务单元</p>
<blockquote>
<p>systemctl list-units –type=service –all</p>
</blockquote>
</li>
<li><p>查看服务单元的启用和禁用状态</p>
<blockquote>
<p>systemctl list-unit-files –type=service</p>
</blockquote>
</li>
<li><p>列出失败的服务</p>
<blockquote>
<p>systemctl –failed –type=service</p>
</blockquote>
</li>
<li><p>列出依赖的单元</p>
<blockquote>
<p>systemctl listdependencies sshd</p>
</blockquote>
</li>
<li><p>禁用network,使之不能自动启动，但手动可以</p>
<blockquote>
<p>systemctl disable network</p>
</blockquote>
</li>
<li><p>启用network</p>
<blockquote>
<p>systemctl enable network </p>
</blockquote>
</li>
<li><p>禁用network,使之不能手动或自动启动</p>
<blockquote>
<p>systemctl mask network</p>
</blockquote>
</li>
<li><p>启用network</p>
<blockquote>
<p>systemctl unmask network</p>
</blockquote>
</li>
</ul>
<p><strong>运行级别</strong></p>
<ul>
<li><p>target units:</p>
<blockquote>
<p>unit配置文件: .target</p>
<p>ls /usr/lib/systemd/system/*.target</p>
<p>systemctl list-unit-files –type target –all</p>
</blockquote>
</li>
<li><p>运行级别</p>
<blockquote>
<p>0 ==&gt; runlevel0.target,poweroff.target</p>
<p>1 ==&gt; runlevel1.target,recue.target</p>
<p>2 ==&gt; runlevel2.target,multi-user.target</p>
<p>3 ==&gt; runlevel3.target,multi-user.target</p>
<p>4 ==&gt; runlevel4.target,multi-user.target</p>
<p>5 ==&gt; runlevel5.target,graphical.target</p>
<p>6 ==&gt; runlevel6.target,reboot.target</p>
</blockquote>
</li>
<li><p>查看依赖性:</p>
<blockquote>
<p>systemctl list-dependencies graphical.target</p>
</blockquote>
</li>
<li><p>级别切换: init N  ==&gt; systemctl isolate name.target</p>
<p>systemctl isolate multi-user.target</p>
<p>注: 只有/lib/systemd/system/*.target文件中AllowIoslate=yes才能切换(修改文件需执行systemctl daemon-reload才能生效)</p>
</li>
<li><p>查看target;</p>
<p>runlevel ; who -r</p>
<p>systemctl list-units –type target</p>
</li>
<li><p>获取默认运行级别</p>
<p>/etc/initab ==&gt; systemctl get-default</p>
</li>
<li><p>修改默认级别</p>
<p>/etc/initab ==&gt; systemctl set-default name.target</p>
<p>systemctl set-default multi-user.target</p>
<p>ls -l  /etc/systemd/system/default.target</p>
</li>
</ul>
<p><strong>other command</strong></p>
<ul>
<li><p>切换至紧急救援摸索</p>
<blockquote>
<p>systemctl rescue</p>
</blockquote>
</li>
<li><p>切换至emergency模式</p>
<blockquote>
<p>systemctl energebcy</p>
</blockquote>
</li>
<li><p>其他常用命令</p>
<p>传统命令init,poweroff,halt,reboot都成为systemctl的软链接</p>
<blockquote>
<p>关机重启: systemctl halt|poweroff|reboot</p>
<p>挂起: systemctl suspend</p>
<p>休眠: systemctl hibernate</p>
<p>休眠并挂起: systemctl hybrid-sleep</p>
</blockquote>
</li>
</ul>
<p><strong>Centos 7引导顺序</strong></p>
<ul>
<li>UEFI或BIOS初始化，运行POST开机自检</li>
<li>选择启动设备</li>
<li>引导装载程序，centos7是grub2</li>
<li>加载装载程序的配置文件:/etc/grub.d/ /etc/default/grub/ /boot/grub2/grub.cfg</li>
<li>加载initramfs驱动模块</li>
<li>加载内核选项</li>
<li>内核初始化,centos 7使用systemd代替init</li>
<li>执行initrd.target所有单元,包括挂载/etc/fstab</li>
<li>从initramfs根文件系统切换到磁盘跟目录</li>
<li>systemd执行默认target配置,配置文件　/etc/systemd/system/default.target</li>
<li>systemd执行sysinit.target初始化系统及basic.target准备操作系统</li>
<li>systemd启动multi-user.target下的本机与服务器服务</li>
<li>systemd执行multi-user.target下的/etc/rc.d/rd.local</li>
<li>systemd执行mult-user.target下的getty.target及登陆服务</li>
<li>systemd换行graphical需要的服务</li>
</ul>
<p><strong>centos 7口令破解</strong></p>
<ul>
<li>启动时e进入编辑模式</li>
<li>在linux16后添加内核参数rd.break，然后ctrl +x</li>
<li>mount -o remount,rw /sysroot</li>
<li>chroot /sysroot</li>
<li>passwd root</li>
<li>touch /.autorelabel</li>
<li>exit</li>
</ul>
<p><strong>修复grub2</strong></p>
<ul>
<li><p>修复主配置文件</p>
<blockquote>
<p>grub2-mkconfig &gt; /boot/grub2/grub.cfg</p>
</blockquote>
</li>
<li><p>修复grub</p>
<blockquote>
<p>grub2-install /dev/sda bios</p>
<p>grub2-install UEFI</p>
</blockquote>
</li>
<li><p>调整默认启动内核</p>
<blockquote>
<p>vim /etc/default/grub</p>
<p>GRUB_DEFAULT=0</p>
</blockquote>
<p>​</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/08/awk.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/08/awk.html" itemprop="url">
                  awk
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-08T22:20:19+08:00">
                2017-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h1><p><strong>基本用法</strong></p>
<ul>
<li>awk [option] ‘program’ var=value file…</li>
<li>awk [option] -f programfile var=value file…</li>
<li>awk [option] ‘BEGIN{action;…}pattern{action;…}END{action;…}’ file</li>
</ul>
<p><strong>awk变量</strong></p>
<ul>
<li>FS: 输入字段分隔符</li>
<li>OFS: 输出字段分隔符，默认为空白字符</li>
<li>RS: 输入记录分隔符,指定输入时的换行符,原换行符仍有效</li>
<li>ORS: 输出记录分隔符，输出时用指定符合代替换行符</li>
<li>NF: 字段数量</li>
<li>NR: 行号</li>
<li>FNR: 各文件分别计数，行号</li>
<li>FILENAME: 当前文件名</li>
<li>ARGC: 命令行参数的个数</li>
<li>ARGV: 数组，保存的三命令行所给定的各参数</li>
</ul>
<p><strong>printf命令</strong></p>
<ul>
<li><p>格式化输出: printf ‘FORMAT’ , item1, item2,…</p>
<ul>
<li>必须指定format</li>
<li>不会自动换行，需要显示给出换行控制符，\n</li>
<li>FORMAT中需要分别为后面的每个item指定格式符</li>
</ul>
</li>
<li><p>格式符：与item一一对应</p>
<ul>
<li>%c: 显示字符的ascii码</li>
<li>%d,%i: 显示十进制整数</li>
<li>%e,%E: 显示科学计数法数值</li>
<li>%f: 显示为浮点数</li>
<li>%g,%G: 以科学计数发或浮点数显示数值</li>
<li>%s: 显示字符串</li>
<li>%u: 无符号整数</li>
<li>%%: 显示%自身</li>
</ul>
</li>
<li><p>修饰符</p>
<ul>
<li>#[.#]: 第一个数字控制显示的宽度；第二个#表示小数点后精度，%3.1f</li>
<li>-: 左对齐(默认右对齐)　%-15s</li>
<li>+: 显示数值的正负符号　%+d</li>
</ul>
</li>
<li><p>操作符</p>
<ul>
<li><p>&amp;&amp; || 非!</p>
</li>
<li><p>函数调用: function_name(argu1, argu2,…)</p>
</li>
<li><p>条件表达式(三目表达式)</p>
<blockquote>
<p>selector?if-true-expressioon:if-false-expression</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk -F: &apos;&#123;3&gt;=500?usertype=&quot;comman user&quot;:usertype=&quot;sysadmin or root&quot;;printf &quot;%-15s:%-s\n&quot;,1,usertype&#125;&apos; /etc/passwd</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>awk PATTERN</strong></p>
<ul>
<li><p>如果为指定：空模式，匹配每一行</p>
</li>
<li><p>/regular expression/: 仅处理能够模式匹配到的行，需要用//括起来</p>
</li>
<li><p>relational expression: 关系表达式，结果为真，才会被处理</p>
<ul>
<li>真：结果为非０，非空字符串</li>
<li>假：结果为空字符串或０值</li>
</ul>
</li>
<li><p>line ranges: 行范围</p>
<p>startline,endline: /pat1/,/pat2/ 不支持直接给出数值格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">awk -F: &apos;/^root\&gt;/,/^nobody\&gt;/&#123;print $1&#125;&apos; /etc/passwd</div><div class="line">awk -F: &apos;(NR&gt;=10&amp;&amp;NR&lt;=20)&#123;print NR,$1&#125;&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>BEGIN/END模式</p>
<p>BEGIN{}:仅在开始处理文件中的文本之前执行一次</p>
<p>END{}: 仅在文本处理完成之后执行一次</p>
</li>
</ul>
<p><strong>控制语句</strong></p>
<ul>
<li><p>if-else</p>
<blockquote>
<p>语法：if(condition){statement;…}[else statement]</p>
<p>​        if(condition1){statement1}else if(condition2){statement2}else{statement3}</p>
<p>使用场景:对awk取得的正行或某个字段做条件判断</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">awk &apos;BEGIN&#123; test=100;if(test&gt;90)&#123;print &quot;very good&quot;&#125;else if(test&gt;60)&#123;print &quot;good&quot;&#125;else&#123;print &quot;no pass&quot;&#125;&#125;&apos;  </div><div class="line">df -Ph| awk -F% &apos;/^\/dev/&#123;print $1&#125;&apos;|awk &apos;$NF&gt;=80&#123;print $1,$5&#125;&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>while循环</p>
<blockquote>
<p>语法: while(condition){statement;…}</p>
<p>使用场景: 对一行内的多个字符逐一类似处理时使用，对数组中的各元素逐一处理时使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF)&#123;if(length($i)&gt;=10)&#123;print $i,length($i)&#125;;i++&#125;&#125;&apos; /etc/grub2.cfg</div></pre></td></tr></table></figure>
</li>
<li><p>do-while循环</p>
<blockquote>
<p>语法：do {statement;…}while(condition)</p>
<p>意义:无论真假，至少循环一次</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;BEGIN&#123;totle=0;i=0;do&#123;total+=i;i++&#125;while(i&lt;=100);print total&#125;&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>for循环}}</p>
<blockquote>
<p>语法: for(expr1;expr2;expr3) {statement;…}</p>
<p>常见用法:</p>
<p>​    for( variable assignment;condition;iteration process)</p>
<p>特殊用法: 遍历数组中的元素</p>
<p>​    语法: for(var in array) {for-body}</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/^[[:space:]]*linux16/&#123;for(i=1;i&lt;=NF;i++)&#123;print $i,length($i)&#125;&#125;&apos; /etc/grub2.cfg</div></pre></td></tr></table></figure>
</li>
<li><p>switch语句</p>
<blockquote>
<p>语法: switch(expression){case VALUE1 or /REGEXP/:statement1;case VALUE2 or /REGEXP2/:statement…;default:statementn}</p>
</blockquote>
</li>
<li><p>break和continue</p>
<blockquote>
<p>awk ‘BEGIN{sum=0;for(i=0;i&lt;=100;i++){if(i%2==0)continue;sum+=i}print sum}’</p>
<p>awk ‘BEGIN{sum=0;for(i=1;i&lt;=100;i++){if(i==66)break;sum+=i}print sum}’</p>
</blockquote>
</li>
<li><p>next</p>
<blockquote>
<p>提前结束对本行处理而直接进入下一行处理(awk自身循环)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk -F: &apos;&#123;if($3%2!=0) next; print $1,$3&#125;&apos; /etc/passwd</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>AWK数组</strong></p>
<ul>
<li><p>index-expression</p>
<ul>
<li><p>可以使用任意字符串；字符串要使用双引号括起来</p>
</li>
<li><p>如果某数组元素事先不存在，在引用时，awk会自动创建此元素，并将其值初始化为空串</p>
</li>
<li><p>若要判断数组中是否存在某元素，要使用”index in array”格式进行遍历</p>
<blockquote>
<p>示例: weedays[“mon”]=”Monday”</p>
<p>awk ‘BEGIN{weekdays[“mon”]=”Monday”;weekdays[“tue”]=”Tuesday”;print weekdays[“mon”]}’</p>
<p>用for循环遍历array的每个索引</p>
<p>awk ‘BEGIN{weekdays[“mon”]=”Monday”;weekdays[“tue”]=”Tuesday”;for(i in weekdays){print weekdays[i]}}’</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>AWK函数</strong></p>
<ul>
<li><p>数值处理</p>
<ul>
<li><p>rand(): 返回0和1之间一个随机数</p>
<blockquote>
<p>awk ‘BEGIN{srand();for(i=1;i&lt;=10;i++)print int(rand()*100)}’</p>
</blockquote>
</li>
</ul>
</li>
<li><p>字符串处理</p>
<ul>
<li><p>length([s]): 返回指定字符串的长度</p>
</li>
<li><p>sub(r,s[t]): 对t字符串进行搜索r表示模式匹配的内容，并将第一个匹配的内容替换为s</p>
<blockquote>
<p>[root@vmbox6 ~]# echo “2008:08:08 08:08:08” | awk ‘sub(/:/,”-“,$1)’<br>2008-08:08 08:08:08</p>
</blockquote>
</li>
<li><p>gsub(r,s[t]): 对t字符串进行搜索r表示模式匹配的内容，并全部替换为s所表示的内容</p>
<blockquote>
<p>[root@vmbox6 ~]# echo “2008:08:08 08:08:08” | awk ‘gsub(/:/,”-“,$1)’<br>2008-08-08 08:08:08</p>
</blockquote>
</li>
<li><p>split(s,array,[r]): 以r为分隔符，切割字符串，并将切割后的结果保存之array所表示的数组中，第一个索引为1,第二个索引为2,…</p>
<blockquote>
<p>[root@vmbox6 ~]# netstat -tan | awk ‘/^tcp>/{split($5,ip,”:”);count[ip[1]]++}END{for (i in count) {print i,count[i]}}’<br> 5<br>192.168.56.1 2<br>104.116.243.8 1<br>0.0.0.0 5</p>
</blockquote>
</li>
</ul>
</li>
<li><p>自定义函数</p>
<ul>
<li><p>格式: </p>
<blockquote>
<p>function name ( parameter,parameter, …){</p>
<p>​            statements</p>
<p>​            return expression</p>
<p>}</p>
</blockquote>
</li>
<li><p>示例:</p>
<blockquote>
<p>cat fun.awk</p>
<p>function max(v1,v2){</p>
<p>​    v1&gt;v2?var=v1:var=v2</p>
<p>​    return var</p>
<p>}</p>
<p>BEGIN{a=3;b=2;print max(a,b)}</p>
<p>awk -f fun.awk</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>AWK中调用shell命令</strong></p>
<ul>
<li><p>system命令</p>
<blockquote>
<p>空格是awk中的字符串连接符，如果system中需要使用awk中的变量可以使用空格分割，或者说除了awk的变量外其他一律用””引用起来</p>
<p>awk BEGIN’{system(“hostname”)}’</p>
<p>awk BEGIN’{score=100;system(“echo your score is “ score)}’</p>
</blockquote>
</li>
</ul>
<p><strong>AWK脚本</strong></p>
<ul>
<li><blockquote>
<p>cat a.awk</p>
<p>#!/bin/awk -f</p>
<p>{if($3&gt;=1000)print \$1,\$3}</p>
</blockquote>
<p>chmod +x a.awk</p>
<p>a.awk -F:  /etc/passwd</p>
</li>
</ul>
<p><strong>向AWK脚本传递参数</strong></p>
<ul>
<li><p>格式:</p>
<blockquote>
<p>awkfile var=value var2=value2 …   Inputfile</p>
</blockquote>
<p><strong>注意</strong> ： 在BEGIN过程中不可用。知道首行输入完成以后，变量才可用。可以通过-v参数，让awk在执行BEGIN之前得到变量的值。命令行中每一个指定的变量都需要一个-v参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@vmbox6 ~]# cat test.awk </div><div class="line">#!/bin/awk -f</div><div class="line">&#123;if($3 &gt;= min &amp;&amp; $3 &lt;= max)print $1,$3&#125;</div><div class="line"></div><div class="line">[root@vmbox6 ~]# ./test.awk -F: -v  min=100 -v  max=200 /etc/passwd</div><div class="line">usbmuxd 113</div><div class="line">avahi-autoipd 170</div><div class="line">abrt 173</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/05/selinux.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/05/selinux.html" itemprop="url">
                  selinux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T20:27:29+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SELINUX"><a href="#SELINUX" class="headerlink" title="SELINUX"></a>SELINUX</h2><h4 id="Selinux简介"><a href="#Selinux简介" class="headerlink" title="Selinux简介"></a>Selinux简介</h4><p>SELinux: Secure Enhanced Linux, 是美国国家安全局(NSA=The National Security Agency)和SCC(SecureComputing Corporation)开发的 Linux的一个强制访问控制的<br>安全模块。2000年以GNU GPL发布,Linux内核2.6版本后集成在内核中．</p>
<h4 id="Selinux工作类型"><a href="#Selinux工作类型" class="headerlink" title="Selinux工作类型"></a>Selinux工作类型</h4><ul>
<li>Strict: centos5,每个进程都受到selinux的控制</li>
<li>Targeted: 用来保护常见的网络服务,仅有限进程受到selinux控制,只监控容易被入侵的进程,centos4只保护13个服务,centos5保护88个进程.</li>
<li>minimum: centos7,修改过的targeted,只对选择的网络服务.</li>
<li>mls: 提供MLS(多级安全)机制的安全性.</li>
<li>minimum和mls稳定性不足,未加以应用.</li>
</ul>
<h4 id="Selinux安全上下文"><a href="#Selinux安全上下文" class="headerlink" title="Selinux安全上下文"></a>Selinux安全上下文</h4><ul>
<li>在Selinux中,一切皆对象(object),由存放在inode的扩展属性域的安全元素所控制其访问</li>
<li>所有文件和端口资源和进程都具备安全标签:安全上下文(security context)</li>
<li><strong>安全上下文由5个元素组成</strong><ul>
<li>user:指示登陆系统的用户类型,如root,user_u,system_u多数本地进程都属于自由(unconfined)进程</li>
<li>role:定义文件,进程和用户的用途:文件:object_r,进程和用户:system_r</li>
<li>type:指定数据类型,规则中定义何种进程类型访问何种文件,target策略基于type实现,多服务共用:public_content_t．</li>
<li>sensitivity:限制访问的需要,由组织定义的分层安全级别,如unclassified,secret,top,secret,一个对象有且只有一个sensitivity,分15级,s0最低,Target策略默认使用s0</li>
<li>category:对于特定组织划分不分层的分类,如FBI Secret,NSA secret,一个对象可以有多个categroy,c0-c1023共1024个分类,target策略不使用category.</li>
<li>实际上下文:存放在文件系统中,ls -Z;ps -Z</li>
</ul>
</li>
<li>期望(默认)上下文:存放在二进制的SELINUX策略库(映射目录和期望安全上下文)中　　semanage fcontext -l</li>
</ul>
<h4 id="Selinux状态"><a href="#Selinux状态" class="headerlink" title="Selinux状态"></a>Selinux状态</h4><ul>
<li>enforcing:强制，每个受限的进程都必然受限</li>
<li>permissive:允许,每个受限的进程违规操作不会被禁止,但会被记录与审计日志</li>
<li>disabled:禁用</li>
</ul>
<h4 id="Selinux相关命令"><a href="#Selinux相关命令" class="headerlink" title="Selinux相关命令"></a>Selinux相关命令</h4><ul>
<li>getenforce:获取selinux当前状态</li>
<li>sestatus:查看selinux状态</li>
<li>setenforce 0|1<ul>
<li>0:设置为permissive</li>
<li>1:设置为enforcing</li>
</ul>
</li>
<li>给文件重新打安全标签<ul>
<li>chcon [option] … [-u USER][-r ROLE] [-t TYPE] FILE…</li>
<li>chcon [option]… –reference=RFILE FILE…</li>
<li>-R:递归打标</li>
</ul>
</li>
<li>恢复目录或文件默认的安全上下文:<ul>
<li>restorecon [-R] /path/to/somewhere</li>
</ul>
</li>
<li>semanage:来自policycoreutils-python包</li>
<li>查看安全上下文<ul>
<li>semanage fcontext -l</li>
</ul>
</li>
<li>添加<ul>
<li>semanage fcontext -a -t http_sys_content_t ‘/testdir(/.*)?’</li>
<li>restorecon -Rv /testdir</li>
</ul>
</li>
<li>删除<ul>
<li>semanage fcotext -d -t httpd_sys_content_t ‘/testdir(/.*)?’</li>
</ul>
</li>
</ul>
<h4 id="Selinux布尔值"><a href="#Selinux布尔值" class="headerlink" title="Selinux布尔值"></a>Selinux布尔值</h4><ul>
<li>布尔型规则<ul>
<li>getsebool</li>
<li>setsebool</li>
</ul>
</li>
<li>查看bool命令<ul>
<li>getsebool [-a] boolean</li>
<li>semanage boolean -l</li>
<li>semanage boolean -l -C 查看修改过的布尔值</li>
</ul>
</li>
<li>设置bool值命令<ul>
<li>setsebool [-p] boolean value (on,off)</li>
<li>setsebool [-p] boolean=value (0,1)</li>
</ul>
</li>
</ul>
<h4 id="Selinux日志管理"><a href="#Selinux日志管理" class="headerlink" title="Selinux日志管理"></a>Selinux日志管理</h4><ul>
<li>yum install setroublesshoot(重启生效) 将错误的信息写入/var/log/message</li>
<li>grep setroubleshoot  /var/log/message</li>
<li>sealert -l UUID 查看安全事件日志说明</li>
<li>sealert -a /var/log/audit/audit.log 扫描并分析日志</li>
</ul>
<h4 id="Selinux-help"><a href="#Selinux-help" class="headerlink" title="Selinux help"></a>Selinux help</h4><ul>
<li>yum install selinux-policy-doc (centos6,7)</li>
<li>mandb | makewhatis</li>
<li>man -k _selinux</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/03/vim.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/03/vim.html" itemprop="url">
                  vim
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-03T14:14:08+08:00">
                2017-04-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="vim编辑器"><a href="#vim编辑器" class="headerlink" title="vim编辑器"></a>vim编辑器</h1><p>vim  [option] file</p>
<p>​    +#:打开文件后，直接让光标处于第＃行</p>
<p>​    +/pattern:打开文件后，直接让光标处于第一个被pattern匹配到的行的行首</p>
<p>​    +N file 直接打开file光标在第Ｎ行，默认在最后一行</p>
<p>​    -b file 二进制方式打开</p>
<p>​    -d file1 file2 比较多个文件</p>
<p>​    -m file 只读打开文件</p>
<p>ex file 或　vim -e 直接进入ex模式    </p>
<h2 id="Vim-命令模式光标跳转"><a href="#Vim-命令模式光标跳转" class="headerlink" title="Vim 命令模式光标跳转"></a>Vim 命令模式光标跳转</h2><p><strong>行首行尾跳转</strong></p>
<ul>
<li>^:调整至行首的第一个非空白字符</li>
<li>0:跳转至行首</li>
<li>$:跳转至行尾</li>
</ul>
<p><strong>行间移动</strong></p>
<ul>
<li>#:G扩展模式</li>
<li>#:跳转至由#指定行</li>
<li>Ｇ:最后一行</li>
<li>1G,gg:第一行</li>
</ul>
<p><strong>句间移动</strong></p>
<ul>
<li>):下一句</li>
<li>(:上一句</li>
</ul>
<p><strong>段落间移动</strong></p>
<ul>
<li>}:下一段</li>
<li>{:上一段</li>
</ul>
<p><strong>命令模式翻屏操作</strong></p>
<ul>
<li>Ctrl + f :向文件尾部翻一屏</li>
<li>Ctrl + b :向文件首部翻一屏</li>
<li>Ctrl + d :向文件尾部翻半屏</li>
<li>Ctrl + u: 向文件首部翻半屏</li>
</ul>
<p><strong>字符编辑</strong></p>
<ul>
<li>x:删除光标处的字符</li>
<li>#:删除光标处起始的#个字符</li>
<li>xp:交换光标所在处的字符及其后面字符的位置</li>
<li>~:转换大小写</li>
</ul>
<p><strong>删除命令</strong></p>
<ul>
<li>d:删除命令，可结合光标跳转字符，实现范围删除</li>
<li>d$:删除到行尾</li>
<li>d^:删除到非空行首</li>
<li>d0:删除到行首</li>
<li>dw:</li>
<li>de:</li>
<li>db:</li>
</ul>
<p><strong>复制命令</strong></p>
<ul>
<li>y:复制</li>
<li>y$</li>
<li>y0</li>
<li>y^</li>
<li>ye</li>
<li>yw</li>
<li>yb</li>
<li>yy:复制行</li>
<li>#yy复制多行</li>
</ul>
<p><strong>粘贴命令</strong></p>
<ul>
<li>p:缓冲区存的如果为整行，则粘贴当前光标所在行的下方；否则，则粘贴至当前光标所在行的后面</li>
<li>P:缓冲区存的如果为整行，则粘贴当前光标所在行的上方；否则，则粘贴至当前光标所在处的前面</li>
</ul>
<p><strong>撤销更改</strong></p>
<ul>
<li><p>u撤销最近的更改</p>
</li>
<li><p>#u撤销之前的多次更改</p>
</li>
<li><p>Ｕ撤销光标落在这行后所有此行的更改</p>
</li>
<li><p>按Ctrl -r 重做最后的撤销更改</p>
</li>
<li><p>.重复之前的操作</p>
</li>
<li><p>n.重复前一个操作n次</p>
<p>​</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/03/page.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hee shen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux-2017">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/03/page.html" itemprop="url">
                  笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-03T14:06:11+08:00">
                2017-04-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p>ls  -a 　all<br>    -l  额外的信息<br>    -R 递归<br>    -ld 目录和符合链接信息<br>    -1 文件分行显示<br>    -S 按文件大小排序<br>    -t mtime排序<br>    -u 配合-t选项，显示并按atime从新到旧排序<br>    -U 按目录存放顺序显示<br>    -X 按文件后缀排序</p>
<h2 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h2><p>access time 读取文件内容<br>modify time 改变文件内容(数据)<br>change time 元数据发生改变</p>
<p>##　文件通配符<br>[:digit]<br>[:lower:]<br>[:upper:]<br>[:alpha:]<br>[:alnum:]<br>[:blank:] 水平空白字符<br>[:space:] 水平或垂直空白字符<br>[:punct:] 标点符号<br>[:print:] 可打印字符<br>[:cntrl:] 控制字符<br>[:graph:] 图形字符<br>[:xigit:] 十六进制字符</p>
<h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><p>-i 交互式<br>-r,-R 递归<br>-a 归档，相当与-dR –preserv=all<br>-d: –no-dereference –preserv=link 不复制原文件，只复制链接名<br>–preserv=[=ATTR_LIST]</p>
<pre><code>mode:权限
ownership:属主属组
timestamp:
links
xattr
context
all
</code></pre><p>-p:等于–preserv=mode,ownership,timestamp<br>-v:–verbose</p>
<h2 id="硬链接"><a href="#硬链接" class="headerlink" title="硬链接"></a>硬链接</h2><p>创建硬链接会增加额外的记录项以引用文件<br>对应与同一文件系统上一个物理文件<br>每个目录引用相同的inode号<br>创建时链接数递增<br>删除文件时:</p>
<pre><code>rm命令递减计数的链接
文件要存在，至少有一个链接数
当链接数为０，文件则被删除
</code></pre><p>不能跨越分区或驱动器</p>
<h2 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h2><p>１．一个符合链接指向另一个文件<br>２．ls -l 显示链接名和引用的文件<br>３．一个符合链接的内容是它引用文件的名称<br>４．可以对目录进行<br>５．可以跨分区<br>５指向的是另一个文件的路径；其大小为指向的路径字符串的长度；不增加或减少目标文件inode的引用计数；</p>
<h2 id="file-确定文件内容"><a href="#file-确定文件内容" class="headerlink" title="file 确定文件内容"></a>file 确定文件内容</h2><p>file [option] filename<br>-b 列出文件辨识结果，不显示文件名<br>-f 列车指定文件中内容的文件类型<br>-F 使用指定分割符合替换输出文件名后默认的”:”分割符<br>-L 查看对应软链接对应文件的文件类型</p>
<p>##　管道与重定向</p>
<pre><code>&gt; 把STDOUT重定向到文件
２&gt;　把STDERR重定向到文件
&amp;&gt; 把所有输出重定向到文件
&gt;文件内容会被覆盖 
set -C:全局禁止覆盖
set +C:允许覆盖
&gt;&gt; 追加
2&gt; 覆盖重定向错误输出数据流
２&gt;&gt; 追加重定向错误输出数据流
():合并多个程序的STDOUT
( cal 2007 ; cal 2008 ) &gt; all.txt
</code></pre><h2 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h2><p>tr [option] set1 set2<br>-c 取字符集的补集<br>-d –delete<br>-s 去重复<br>-t 将第一个字符集对应的字符转换为第二个字符集</p>
<h2 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h2><p>文件<br>r 可使用文件查看类工具获取其内容<br>w 可修改其内容<br>x 可以把此文件提请内核启动为一个进程<br>目录<br>r 可以使用ls查看次目录中文件列表<br>w 可在此目录中创建文件，也可删除此目录中的文件<br>x 可以使用ls -l查看此目录中文件列表，可以cd进去<br>目录 X:只给目录x权限，不给文件x权限</p>
<h2 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h2><p>###　可执行文件上的SUID权限<br>１.任何一个可执行程序文件能不能启动为进程:取决发起者对程序文件是否拥有执行权限<br>２.启动为进程之后，其进程的属主为原程序文件的属主<br>３.SUID只对二进制可执行程序有效<br>４.SUID设置在目录上无意义<br>权限设定:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod u+s file</div><div class="line">chmod u-s file</div></pre></td></tr></table></figure></p>
<h3 id="可执行文件上的SGID权限"><a href="#可执行文件上的SGID权限" class="headerlink" title="可执行文件上的SGID权限"></a>可执行文件上的SGID权限</h3><p>１．任何一个可执行程序文件能不能启动为进程；取决发起者对程序文件是否拥有执行权限<br>２．启动为进程之后，其进程的属主为远程序文件的属组<br>３．权限设定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod g+s file</div><div class="line">chmod g-s file</div></pre></td></tr></table></figure></p>
<h3 id="目录上的SGID权限"><a href="#目录上的SGID权限" class="headerlink" title="目录上的SGID权限"></a>目录上的SGID权限</h3><p>１．默认情况下，用户创建文件时，其属组为此用户所属的主组<br>２．一旦某目录被设定了SGID,则对此目录有写权限的用户在此目录中创建的文件所属的组为此目录的属组．<br>３．通常用于创建一个协作目录<br>４．权限设定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod g+s dir</div><div class="line">chmod g-s dir</div></pre></td></tr></table></figure></p>
<h3 id="Sticky位"><a href="#Sticky位" class="headerlink" title="Sticky位"></a>Sticky位</h3><p>１．具有写权限的目录通常用户可以删除该目录中的任何文件，无论该文件的权限或拥有权<br>２．在目录设置Sticky位，只有文件的所有者或root可以删除该文件<br>３．Sticky设置在文件上无意义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod o+t dir</div><div class="line">chmod o-t dir</div></pre></td></tr></table></figure></p>
<h3 id="设定文件特点属性"><a href="#设定文件特点属性" class="headerlink" title="设定文件特点属性"></a>设定文件特点属性</h3><p>chattr +i 不能删除，改名，更改<br>chattr +a 只能追加内容<br>lsattr 显示特定属性</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Hee shen" />
          <p class="site-author-name" itemprop="name">Hee shen</p>
           
              <p class="site-description motion-element" itemprop="description">my notes</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hee shen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  





  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
